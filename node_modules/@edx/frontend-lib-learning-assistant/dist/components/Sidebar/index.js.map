{"version":3,"file":"index.js","names":["_react","_interopRequireWildcard","require","_reactRedux","_propTypes","_interopRequireDefault","_analytics","_paragon","_icons","_APIError","_ChatBox","_Disclosure","_MessageForm","_thunks","_jsxRuntime","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","Sidebar","_ref","courseId","isOpen","setIsOpen","apiError","disclosureAcknowledged","messageList","useSelector","state","learningAssistant","chatboxContainerRef","useRef","dispatch","useDispatch","useEffect","messageContainer","current","scrollHeight","clientHeight","maxScrollTop","duration","startTime","Date","now","endTime","scroll","currentTime","timeFraction","scrollTop","scrollTo","top","behavior","requestAnimationFrame","handleClick","hasWindow","window","hj","handleClearMessages","clearMessages","sendTrackEvent","course_id","getSidebar","jsxs","className","children","jsx","shouldAutofocus","Button","onClick","variant","type","IconButton","src","Close","iconAs","Icon","invertColors","propTypes","PropTypes","string","isRequired","bool","func","_default","exports"],"sources":["../../../src/components/Sidebar/index.jsx"],"sourcesContent":["import React, { useRef, useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport { sendTrackEvent } from '@edx/frontend-platform/analytics';\nimport {\n  Button,\n  Icon,\n  IconButton,\n} from '@edx/paragon';\nimport { Close } from '@edx/paragon/icons';\n\nimport APIError from '../APIError';\nimport ChatBox from '../ChatBox';\nimport Disclosure from '../Disclosure';\nimport MessageForm from '../MessageForm';\nimport './Sidebar.scss';\nimport {\n  clearMessages,\n} from '../../data/thunks';\n\nconst Sidebar = ({\n  courseId,\n  isOpen,\n  setIsOpen,\n}) => {\n  const {\n    apiError,\n    disclosureAcknowledged,\n    messageList,\n  } = useSelector(state => state.learningAssistant);\n  const chatboxContainerRef = useRef(null);\n  const dispatch = useDispatch();\n\n  // this use effect is intended to scroll to the bottom of the chat window, in the case\n  // that a message is larger than the chat window height.\n  useEffect(() => {\n    const messageContainer = chatboxContainerRef.current;\n\n    if (messageContainer) {\n      const { scrollHeight, clientHeight } = messageContainer;\n      const maxScrollTop = scrollHeight - clientHeight;\n      const duration = 200;\n\n      if (maxScrollTop > 0) {\n        const startTime = Date.now();\n        const endTime = startTime + duration;\n\n        const scroll = () => {\n          const currentTime = Date.now();\n          const timeFraction = (currentTime - startTime) / duration;\n          const scrollTop = maxScrollTop * timeFraction;\n\n          messageContainer.scrollTo({\n            top: scrollTop,\n            behavior: 'smooth',\n          });\n\n          if (currentTime < endTime) {\n            requestAnimationFrame(scroll);\n          }\n        };\n\n        requestAnimationFrame(scroll);\n      }\n    }\n  }, [messageList, isOpen, apiError]);\n\n  const handleClick = () => {\n    setIsOpen(false);\n\n    // check to see if hotjar is available, then trigger hotjar event\n    const hasWindow = typeof window !== 'undefined';\n    if (hasWindow && window.hj) {\n      window.hj('event', 'ocm_learning_assistant_chat_closed');\n    }\n  };\n\n  const handleClearMessages = () => {\n    dispatch(clearMessages());\n    sendTrackEvent('edx.ui.lms.learning_assistant.clear', {\n      course_id: courseId,\n    });\n  };\n\n  const getSidebar = () => (\n    <div className=\"h-100 d-flex flex-column justify-content-stretch\">\n      <div className=\"d-flex flex-column align-items-center p-3\">\n        <h1 className=\"font-weight-bold mb-3\">\n          Hi, I&apos;m Xpert!\n        </h1>\n        <p className=\"px-3 mb-0 text-center\">\n          Stuck on a concept? Need more clarification on a complicated topic?\n          Let&apos;s chat!\n        </p>\n      </div>\n      <span className=\"separator\" />\n      <ChatBox\n        chatboxContainerRef={chatboxContainerRef}\n        messageList={messageList}\n      />\n      {\n        apiError\n        && (\n          <div className=\"d-flex flex-column p-3 mt-auto\">\n            <APIError />\n          </div>\n        )\n      }\n      <MessageForm courseId={courseId} shouldAutofocus />\n      <div className=\"d-flex justify-content-start\">\n        <Button\n          className=\"clear mx-2 mb-2 border-0\"\n          onClick={handleClearMessages}\n          aria-label=\"clear\"\n          variant=\"primary\"\n          type=\"button\"\n        >\n          Clear\n        </Button>\n      </div>\n    </div>\n  );\n\n  return (\n    isOpen && (\n      <div\n        className=\"sidebar position-fixed\"\n      >\n        <IconButton\n          className=\"chat-close position-absolute m-2 border-0\"\n          src={Close}\n          iconAs={Icon}\n          data-testid=\"close-button\"\n          onClick={handleClick}\n          aria-label=\"close\"\n          variant=\"primary\"\n          invertColors={!disclosureAcknowledged}\n        />\n        {disclosureAcknowledged ? (getSidebar()) : (<Disclosure courseId={courseId} />)}\n      </div>\n    )\n  );\n};\n\nSidebar.propTypes = {\n  courseId: PropTypes.string.isRequired,\n  isOpen: PropTypes.bool.isRequired,\n  setIsOpen: PropTypes.func.isRequired,\n};\n\nexport default Sidebar;\n"],"mappings":"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"}